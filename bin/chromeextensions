#!/usr/bin/env bash

mkdir /tmp/extensions

get_extension(){
	local extname="$1"
	local zipname="$(basename $2)"
	local crxname="$(echo $zipname | sed 's|.zip|.crx|')"
	sh -c "cd /tmp; wget $2"
	mv "/tmp/$zipname" /tmp/extensions/$crxname
}

# UblockOrigin
ublock_url="$(curl -sL https://api.github.com/repos/gorhill/uBlock/releases/latest | grep -E 'browser_download_url.*chromium' | cut -d '"' -f 4)"
get_extension ublock $ublock_url
# ViolentMonkey
monkey_url="$(curl -sL https://api.github.com/repos/violentmonkey/violentmonkey/releases/latest | grep 'browser_download_url.*zip' | cut -d '"' -f 4)"
get_extension violentmonkey $monkey_url
# Keepassxc
keepass_url="$(curl https://api.github.com/repos/keepassxreboot/keepassxc-browser/releases/latest | grep 'browser_download_url.*chromium' | cut -d '"' -f 4)"
get_extension keepass $keepass_url
# Darkreader
reader_url="$(curl https://api.github.com/repos/darkreader/darkreader/releases/latest | grep 'browser_download_url.*chrome.zip' | cut -d '"' -f 4)"
get_extension darkreader $reader_url
# XBrowserSync
browsersync_url="$(curl https://api.github.com/repos/xbrowsersync/app/releases/latest | grep 'browser_download_url.*chrome.zip' | cut -d '"' -f 4)"
get_extension browsersync $browsersync_url
# Chromium-Web-Store
web_url="$(curl -sL https://api.github.com/repos/NeverDecaf/chromium-web-store/releases/latest | grep -E 'browser_download_url.*crx' | cut -d '"' -f 4)"
sh -c "cd /tmp/extensions; wget $web_url"
